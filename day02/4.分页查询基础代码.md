### 分页查询笔记（PageHelper + PageQueryDTO + PageResult）

#### 1. 核心思路
分页查询通常分两块：

- **接收前端分页与筛选条件**：用 *分页查询 DTO*（PageQueryDTO）
- **把查询结果返回给前端**：用 *PageResult* 封装（total + records）

---

#### 2. 关键类说明

##### 2.1 PageResult（返回给前端的分页查询结果）
用途：封装分页查询结果，由 Controller 返回给前端使用。和Result类一样，需要自己定义，而非spring提供

常见字段：
- `long total`：总记录数
- `List records`：当前页的数据集合

> 可以把它理解成：“前端需要的分页结果格式”。

---

##### 2.2 分页查询 DTO（接收前端请求参数）
用途：接收前端传来的查询条件 + 分页参数，并作为 Service / Mapper 的传参。

常见字段：
- 查询条件：如 `id / name / status ...`
- `int page`：页码
- `int pageSize`：单页数量

> 可以把它理解成：“前端请求参数的封装载体”。

---

#### 3. 标准流程（从前端到数据库再返回）

##### 3.1 总体流程图
前端请求参数 → 封装入PageQueryDTO → Controller → Service → Mapper → PageHelper(Page) → PageResult → 前端

---

#### 4. 分层实现步骤

##### 4.1 Controller 层
职责：接收 PageQueryDTO 参数，调用 Service，返回 `Result<PageResult>`。

```java
	public Result<PageResult> page(EmployeePageQueryDTO employeePageQueryDTO) {

		log.info("员工分页查询: {}", employeePageQueryDTO);

		return Result.success(employeeService.pageQuery(employeePageQueryDTO));
	}
```
##### 4.2 Service 层
职责：
1. 调用 PageHelper.startPage(page, pageSize) 设定分页参数

2. 调用 Mapper 查询（查询结果会被 PageHelper 自动分页）

3. 封装成 PageResult 返回
```java
	public PageResult pageQuery(EmployeePageQueryDTO employeePageQueryDTO) {

		// 1. 设置分页参数
		PageHelper.startPage(employeePageQueryDTO.getPage(), employeePageQueryDTO.getPageSize());

		// 2. 调用Mapper执行查询：Page 本质上是一个 List（但携带 total 等分页信息）
		Page<Employee> p = employeeMapper.pageQuery(employeePageQueryDTO);

		// 3. 封装并返回结果
		return new PageResult(p.getTotal(), p.getResult());
	}
```

##### 4.3 Mapper 层（接口）
职责：声明分页查询方法，参数通常为 pageQueryDTO 。
```java
	Page<Employee> pageQuery(EmployeePageQueryDTO employeePageQueryDTO);
```
对应 xml 中的 动态sql 语句
```xml
	<select id="pageQuery" resultType="com.sky.entity.Employee">
		select * from employee
		<where>
			<if test="name != null and name != ''">
				and name like concat('%', #{name}, '%')
			</if>
		</where>
		order by create_time desc
	</select>
```
